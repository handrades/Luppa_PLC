#!/usr/bin/env sh

# Exit immediately on any command failure
set -e

# First, run lint-staged to auto-fix and format staged files
echo "ğŸ”§ Auto-fixing and formatting staged files..."
npx lint-staged

# Then run additional psake checks if PowerShell is available
if command -v pwsh >/dev/null 2>&1; then
  echo "ğŸ” Running additional psake checks..."
  timeout 600 pwsh -NoProfile -NonInteractive -ExecutionPolicy Bypass -Command "Invoke-Psake CI" || {
    echo "âš ï¸  Pre-commit checks timed out after 10 minutes"
    exit 1
  }
fi

echo "âœ… Pre-commit checks completed"
