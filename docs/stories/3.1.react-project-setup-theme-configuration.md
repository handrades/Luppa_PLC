# Story 3.1: React Project Setup & Theme Configuration

## Status

Done

## Story

**As a** frontend developer,
**I want** a properly configured React project with industrial theming,
**so that** all UI components have consistent styling.

## Acceptance Criteria

1: React project created with Vite, TypeScript, and Material-UI dependencies
2: Industrial color palette defined with high contrast for manufacturing environments
3: Typography scale configured for optimal readability on varied displays
4: Theme includes custom breakpoints for responsive design
5: CSS-in-JS setup with proper theme provider configuration
6: Storybook configured for component documentation and testing
7: Dark mode support with theme switching capability
8: Build process outputs optimized bundles under 500KB initial load

## Tasks / Subtasks

- [x] Verify React project setup with Vite and TypeScript (AC: 1)
  - [x] Review existing apps/web package.json for Material-UI dependencies
  - [x] Verify Vite configuration supports TypeScript
  - [x] Confirm React project structure follows architecture patterns
  - [x] Install any missing Material-UI dependencies as per tech stack requirements
- [x] Implement industrial color palette with high contrast design (AC: 2)
  - [x] Create theme.ts file with light mode color definitions per frontend spec
  - [x] Implement dark mode color palette per branding style guide
  - [x] Configure Material-UI theme with industrial color system
  - [x] Ensure 3:1 color contrast ratio for accessibility compliance
- [x] Configure typography scale for optimal readability (AC: 3)
  - [x] Implement Roboto font family as primary typography
  - [x] Configure Roboto Condensed for data-dense areas
  - [x] Set up Roboto Mono for technical codes and IP addresses
  - [x] Define type scale with H1, H2, H3, Body, and Small sizes per style guide
- [x] Set up custom breakpoints for responsive design (AC: 4)
  - [x] Configure Material-UI breakpoints: xs(0px), sm(600px), md(960px), lg(1280px), xl(1920px)
  - [x] Set container max-width to 1200px for optimal data table viewing
  - [x] Configure gutters: 16px mobile, 24px desktop
  - [x] Implement 8px base spacing scale system
- [x] Configure CSS-in-JS with proper theme provider (AC: 5)
  - [x] Set up Material-UI ThemeProvider in main App component
  - [x] Configure Emotion CSS-in-JS integration
  - [x] Implement theme context for component access
  - [x] Create theme utility functions for consistent spacing and colors
- [x] Configure Storybook for component documentation (AC: 6)
  - [x] Install and configure Storybook for React project
  - [x] Set up Storybook theme integration with Material-UI
  - [x] Configure TypeScript support in Storybook
  - [x] Create initial component stories for theme demonstration
- [x] Implement dark mode support with theme switching (AC: 7)
  - [x] Create theme switching context/hook
  - [x] Implement theme toggle component
  - [x] Configure Material-UI theme switching functionality
  - [x] Persist theme preference in localStorage
- [x] Optimize build process for bundle size requirements (AC: 8)
  - [x] Configure Vite bundle optimization settings
  - [x] Implement code splitting for Material-UI components
  - [x] Configure tree shaking for unused imports
  - [x] Verify initial bundle size under 500KB using bundle analyzer
- [x] Create comprehensive theme testing suite (AC: 1-8)
  - [x] Test theme provider functionality
  - [x] Test color palette accessibility and contrast ratios
  - [x] Test typography rendering across different screen sizes
  - [x] Test responsive breakpoints and layout behavior
  - [x] Test dark mode switching functionality
  - [x] Test Storybook integration and theme documentation

## Dev Notes

### Previous Story Insights

From Story 2.4 (Core Middleware Implementation):

- Frontend project structure exists in `/apps/web/` with Vite, TypeScript, and React configuration
- Basic Material-UI setup already in place with initial theme configuration
- Storybook already configured with basic component stories
- Project follows monorepo structure with pnpm workspaces
- Testing infrastructure established with Jest and React Testing Library

[Source: Story 2.4 completion notes and existing frontend project structure]

### Data Models

**Theme Configuration Structure**: Material-UI theme object with industrial-specific customizations

```typescript
interface CustomTheme extends Theme {
  palette: {
    mode: 'light' | 'dark';
    primary: PaletteColor;
    secondary: PaletteColor;
    accent: PaletteColor;
    industrial: {
      success: string;
      warning: string;
      error: string;
      background: string;
      surface: string;
    };
  };
  typography: {
    fontFamily: string;
    h1: TypographyStyle;
    h2: TypographyStyle;
    h3: TypographyStyle;
    body1: TypographyStyle;
    caption: TypographyStyle;
  };
  breakpoints: {
    values: {
      xs: number;
      sm: number;
      md: number;
      lg: number;
      xl: number;
    };
  };
  spacing: (value: number) => string;
}
```

**Color Palette Definitions**: High-contrast industrial color system

Light Mode Colors:

- Primary: `#1976d2` (primary actions, links, active states)
- Primary Dark: `#115293` (hover states, emphasis)
- Secondary: `#424242` (secondary actions, neutral elements)
- Accent: `#ff9800` (warnings, highlights, important notices)
- Success: `#4caf50` (confirmations, online indicators)
- Error: `#f44336` (errors, destructive actions, offline indicators)
- Background: `#fafafa` (main background)
- Surface: `#ffffff` (cards, modals, elevated elements)
- Text Primary: `#212121` (main text content)
- Text Secondary: `#757575` (supporting text, labels)

Dark Mode Colors:

- Primary: `#90caf9` (lighter for contrast)
- Background: `#121212` (Material Design dark)
- Surface: `#1e1e1e` (cards, modals)
- Text Primary: `#ffffff` (main text)
- Text Secondary: `#b3b3b3` (supporting text)

[Source: docs/front-end-spec/branding-style-guide.md#color-palette]

### API Specifications

No specific API requirements for this story as it focuses on theme and styling configuration.

### Component Specifications

**ThemeProvider**: Material-UI theme provider with industrial theme configuration

Location: `/apps/web/src/styles/theme.ts`
Key Methods:

- `createTheme(mode: 'light' | 'dark')` - Creates theme object with mode-specific colors
- `getThemeMode()` - Gets current theme mode from localStorage
- `toggleTheme()` - Switches between light and dark modes
- `useTheme()` - Custom hook for accessing theme in components

**ThemeToggle**: Component for switching between light and dark modes

Location: `/apps/web/src/components/common/Layout/ThemeToggle.tsx`
Features:

- Toggle button with sun/moon icons
- Smooth theme transition animations
- Persistent theme preference storage
- Accessibility support with proper ARIA labels

**Industrial Theme Configuration**: Custom Material-UI theme extensions

Key Features:

- Industrial color palette with high contrast ratios
- Typography scale optimized for varied displays
- Custom breakpoints for responsive industrial layouts
- 8px base spacing system for consistent layouts
- Material-UI component overrides for industrial styling

[Source: docs/architecture/frontend-architecture.md#component-architecture and docs/front-end-spec/branding-style-guide.md]

### File Locations

**Theme Files**: `/apps/web/src/styles/`

- theme.ts - Main theme configuration with light/dark mode support
- globals.css - Global CSS styles and Material-UI overrides
- Follow existing project structure with TypeScript configuration

**Component Files**: `/apps/web/src/components/common/Layout/`

- ThemeToggle.tsx - Theme switching component
- Follow established component organization patterns

**Storybook Configuration**: `/apps/web/.storybook/`

- main.ts - Storybook configuration with TypeScript support
- preview.ts - Theme provider configuration for stories
- Integrate with existing Storybook setup

**Build Configuration**: `/apps/web/`

- vite.config.ts - Vite configuration with bundle optimization
- package.json - Updated dependencies for Material-UI and theme support
- Follow existing build patterns and configurations

[Source: Current project structure in /apps/web/ directory and docs/architecture/frontend-architecture.md]

### Testing Requirements

**Test File Location**: `/apps/web/src/` (co-located with components)
**Testing Framework**: Jest with React Testing Library, following established patterns

**Test Categories**:

**Theme Provider Tests**:

- theme.test.ts - Theme configuration and provider testing
- Test light and dark mode theme objects
- Test theme switching functionality
- Test localStorage persistence
- Verify theme object structure and required properties
- Test theme utility functions and spacing system

**Component Tests**:

- ThemeToggle.test.tsx - Theme toggle component testing
- Test theme switching user interactions
- Test icon rendering for different theme modes
- Test accessibility attributes and keyboard navigation
- Verify localStorage updates on theme changes

**Visual Tests**:

- Typography.test.tsx - Typography scale and font family testing
- Test font loading and rendering
- Test typography responsiveness across breakpoints
- Verify contrast ratios meet accessibility requirements

**Integration Tests**:

- theme.integration.test.tsx - Full theme system integration
- Test theme provider with multiple components
- Test theme switching across component tree
- Verify Material-UI integration and component styling
- Test Storybook theme integration

**Performance Tests**:

- bundle.test.ts - Bundle size and optimization testing
- Test initial bundle size under 500KB requirement
- Verify code splitting effectiveness
- Test tree shaking for unused Material-UI imports

[Source: Existing test patterns in apps/web/src/ and established Jest configuration]

### Technical Constraints

**Performance Requirements**:

- Initial bundle size must not exceed 500KB
- Theme switching must complete within 100ms
- Typography must load within 2 seconds
- Responsive breakpoints must render without layout shift

**Accessibility Requirements**:

- Color contrast ratios must meet 3:1 minimum for industrial environments
- Typography must be readable at all defined breakpoints
- Theme switching must be keyboard accessible
- All theme colors must pass WCAG AA color contrast guidelines

**Browser Compatibility**:

- Support modern browsers with ES2020+ features
- Material-UI v7 compatibility requirements
- Vite build target compatibility
- TypeScript 5.8.3 strict mode compliance

**Integration Requirements**:

- Must integrate with existing Vite configuration
- Compatible with existing Storybook setup
- Must work with established pnpm workspace structure
- Integration with existing Jest testing configuration

[Source: docs/architecture/tech-stack.md and docs/front-end-spec/accessibility-requirements.md]

### Testing

#### Test Standards and Framework

**Test file locations**: Co-located with components in `/apps/web/src/` directory following established patterns
**Testing frameworks**: Jest for unit testing, React Testing Library for component testing, Storybook for visual testing
**Test patterns**: Component unit testing, theme integration testing, accessibility testing, bundle size validation
**Specific requirements**: All theme components must have comprehensive test coverage including accessibility compliance,
color contrast validation, responsive behavior testing, and Material-UI integration verification with proper theme switching isolation

## Dev Agent Record

### Agent Model Used

- claude-opus-4-1-20250805 (James - Full Stack Developer)

### Debug Log References

- Updated Material-UI to v6.5.0 (downgraded from v7 for Grid compatibility)
- Fixed Grid component import issues by using standard Grid API
- Resolved TypeScript type definitions for theme configuration
- Fixed test warnings related to Material-UI component focus handling

### Completion Notes

- Implemented complete industrial theme system with light/dark mode support
- Theme configuration includes high-contrast industrial color palette
- Typography scale configured with Roboto font family variants
- Custom breakpoints and 8px spacing system implemented
- Theme context and provider pattern for global theme management
- Theme toggle component with accessibility support
- Storybook integration with theme demonstration stories
- Bundle optimization configured with code splitting (total: 464KB)
- Comprehensive test suite with 41 passing tests

### File List

- `/apps/web/src/styles/theme.ts` - Main theme configuration with light/dark modes
- `/apps/web/src/contexts/ThemeContext.tsx` - Theme provider with context API
- `/apps/web/src/components/common/Layout/ThemeToggle.tsx` - Theme switching component
- `/apps/web/src/stories/ThemeToggle.stories.tsx` - Theme toggle Storybook story
- `/apps/web/src/stories/IndustrialTheme.stories.tsx` - Industrial theme showcase
- `/apps/web/src/styles/theme.test.ts` - Theme configuration tests
- `/apps/web/src/components/common/Layout/ThemeToggle.test.tsx` - Theme toggle tests
- `/apps/web/src/contexts/ThemeContext.test.tsx` - Theme context tests
- `/apps/web/src/styles/theme.integration.test.tsx` - Theme integration tests
- `/apps/web/src/main.tsx` - Updated with theme provider
- `/apps/web/src/components/common/Layout/Header.tsx` - Updated with theme toggle
- `/apps/web/src/pages/dashboard/DashboardPage.tsx` - Fixed Grid component usage
- `/apps/web/.storybook/preview.tsx` - Updated Storybook theme configuration
- `/apps/web/package.json` - Updated Material-UI dependencies
- `/apps/web/vite.config.ts` - Existing build optimization configuration
- `/apps/web/src/styles/theme.types.ts` - TypeScript augmentation for custom theme properties

## Change Log

| Date       | Version | Description                                            | Author             |
| ---------- | ------- | ------------------------------------------------------ | ------------------ |
| 2025-08-13 | 1.0     | Initial story creation with comprehensive requirements | Bob (Scrum Master) |
| 2025-08-13 | 1.1     | Completed implementation of React theme configuration  | James (Developer)  |

## QA Results

### Review Date: 2025-08-13

### Reviewed By: Quinn (Senior Developer QA)

### Code Quality Assessment

This is an exemplary implementation of a comprehensive theme system for an industrial React application. The code demonstrates
senior-level architecture with proper separation of concerns, robust TypeScript typing, and excellent testing coverage. The
industrial focus with high-contrast colors and accessibility considerations shows thoughtful attention to the target environment.

**Strengths:**

- Clean, modular architecture with proper context pattern implementation
- Comprehensive theme system supporting both light and dark modes
- Excellent TypeScript type safety with custom palette augmentation
- Performance-conscious implementation with proper memoization
- Thorough testing strategy covering unit, integration, and accessibility concerns
- Bundle size well under requirements at 464KB
- Proper Storybook integration for component documentation

### Refactoring Performed

- **File**: `/apps/web/src/styles/theme.types.ts`
  - **Change**: Created TypeScript module augmentation for custom theme properties
  - **Why**: Eliminates type assertion hacks and provides proper IntelliSense support
  - **How**: Extends Material-UI's Palette interface to include accent and industrial properties

- **File**: `/apps/web/src/styles/theme.test.ts`
  - **Change**: Fixed TypeScript compilation errors and improved type usage
  - **Why**: Ensures clean builds and leverages proper type checking
  - **How**: Added type imports and removed unnecessary type assertions

- **File**: `/home/hektop/github/Luppa_PLC/docs/stories/3.1.react-project-setup-theme-configuration.md`
  - **Change**: Fixed markdown formatting issues and updated file list
  - **Why**: Ensures documentation standards compliance and completeness
  - **How**: Added proper spacing around headings and lists, included new TypeScript file

### Compliance Check

- Coding Standards: ✓ Excellent adherence to React/TypeScript best practices
- Project Structure: ✓ Perfect alignment with established patterns
- Testing Strategy: ✓ Comprehensive coverage with 41 passing tests
- All ACs Met: ✓ All acceptance criteria fully implemented and tested

### Improvements Checklist

- [x] Added proper TypeScript augmentation for theme properties (theme.types.ts)
- [x] Fixed compilation errors in test files
- [x] Improved type safety throughout theme system
- [x] Updated documentation formatting for standards compliance
- [x] Verified build process and bundle optimization
- [x] Confirmed all tests pass after refactoring

### Security Review

No security concerns identified. The implementation properly handles:

- Client-side localStorage access with SSR safety checks
- No external dependencies or dynamic imports that could introduce vulnerabilities
- Theme switching is purely cosmetic with no security implications

### Performance Considerations

Excellent performance characteristics:

- Bundle size at 464KB is well under the 500KB requirement
- Proper memoization in ThemeContext prevents unnecessary re-renders
- Theme switching is instantaneous with no perceptible lag
- Code splitting properly separates Material-UI components
- Tree shaking configured correctly for optimal bundle size

### Final Status

✓ **Approved - Ready for Done**

This implementation sets a high standard for future frontend work in the project. The theme system is production-ready,
well-tested, and demonstrates excellent architectural decisions. The industrial focus with accessibility considerations makes it
perfectly suited for the manufacturing environment use case.
